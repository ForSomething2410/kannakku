<html>
<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buffet</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <style>
body {
  background: #0d0d0d;
  color: #e0e0e0;
  font-family: sans-serif;
  padding: 1rem;
  max-width: 28rem;
  margin: 0 auto;
}

.hd {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  margin-bottom: 1.5rem;
}

.hd h1 {
  font-size: 1.125rem;
  font-weight: 400;
  color: #f0f0f0;
}

.l, .r {
  position: absolute;
  display: flex;
  gap: 0.5rem;
  font-size: 0.875rem;
  font-weight: 300;
  color: #b0b0b0;
}

.l {
  left: 0;
}

.r {
  right: 0;
  align-items: center;
}

.btn-add {
  width: 1.75rem;
  height: 1.75rem;
  border: 1px solid #333;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.125rem;
  font-weight: 300;
  line-height: 1;
  background: #1a1a1a;
  color: #ccc;
  cursor: pointer;
}

.main {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 2rem;
}

.btn {
  width: 100%;
  border: 1px solid #444;
  border-radius: 0.375rem;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  font-weight: 400;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #1a1a1a;
  color: #f0f0f0;
}

.btn:hover {
  background: #222;
}

.val {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #9ee9ff; /* Light cyan for values */
}

.sec h2 {
  font-size: 1rem;
  font-weight: 400;
  margin-bottom: 0.5rem;
  color: #f0f0f0;
}

.box, .box2 {
  border: 1px solid #333;
  border-radius: 0.375rem;
  font-size: 1rem;
  font-weight: 400;
  margin-bottom: 1rem;
  background: #1a1a1a;
}

.row {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid #333;
  padding: 0.75rem 1rem;
  background: #141414;
  color: #ddd;
}

.row span:first-child {
  color: #62e6ff;
  font-weight: 500;
}

.row span:last-child {
  color: #ffb56b; 
}

.txt {
  padding: 0.75rem 1rem;
  width: 90%;
  overflow-x: scroll;
  color: #d0d0d0; 
  font-size: 0.9rem;
  line-height: 1.4;
}

.box2 {
  padding: 0.75rem 1rem;
}

.bar {
  margin-top: 0.5rem;
  height: 1rem;
  border-top: 1px solid #000;
}

.als {
  display: flex;
   background: #1a1a1a;
  margin: 1px;
  border: 1px solid #333;
  padding:9px;
  border-radius:0.375rem;
  
}

.inc {
width:100%;
  display: flex;
  justify-content: space-around;
  align-items:center;
}


#allbl {
  font-size: 1.5rem;
  color: #62e6ff;
}

#allex {
  color: #ff9b6b;
}

#allbal {
  color: #a0e49d;
}

#incadi {
  font-size: 1.6rem;
  text-align: center;
  color: #8aff8a;
}

  .swal2-input {
  width: 90%;
  box-sizing: border-box;
  background-color: white;
  color: black;
  border: 1px solid #444;
  border-radius: 6px;
  padding: 8px;
  font-size: 18px;
  margin: 6px auto;
  display: block;
  }
  
  .swal2-input::placeholder {
  color: black;
  }
  
  .swal2-popup {
  background-color: white;
  color: #eee;
  }
  
  .swal2-title {
  color: black;
  }
  
  .teic{
  display:flex;
  gap:25px;
  }
  .teic i{
  color:white;
  }
  
  .trh{
  display: flex;
  background: #1a1a1a;
  justify-content: space-between;
  align-items:center;
  margin: 1px;
  border: 1px solid #333;
  padding:9px;
  border-radius:0.375rem;
  
  }
  
  .trh font:last-child{
  font-size:1.6rem;
  }
  
  </style>
</head>
<body>
  <header class="hd">
    <h1>Buffet</h1>
    
  </header>

<div class="als">

<div class="inc">
   <font id="allbal"> 0 </font>
   <font id="allbl"> 0 </font>
   <font id="allex"> 0 </font>
</div>


</div>

<br>
  <main class="main">
    <button class="btn" onclick="location.href='invest.html'">
      <span>Invert</span>
      <span class="val"><span id="incva"> 0 </span><i class="fas fa-chevron-right"></i></span>
    </button>
    <button class="btn" onclick="location.href='saving.html'">
      <span>Saving</span>
      <span class="val"><span> 0 </span><i class="fas fa-chevron-right"></i></span>
    </button>
    <button class="btn" onclick="location.href='other.html'">
      <span>Other</span>
      <span class="val"><span> 0 </span><i class="fas fa-chevron-right"></i></span>
    </button>
  </main>
<div class="trh">
    <font> Income Sources 12345</font> <font onclick="addDiv()"> + </font>
    </div>
    <br>
  <section class="sec" id="transSe">
    <!--
    <div class="box">
      <div class="row"><span class="inso">1234</span><span>ten</span> <span class="teic"> <i class="bi bi-trash" onclick="rdiv(this);"> </i> <i class="bi bi-pencil"> </i></span></div>
      <div class="txt">iaajjxzjzjzjsjjdjdjdjejewjwjw wjwuwjwjwuwu jwhwnzznzjz jsueueuei33uejsjsh shshsjs sidjdjdjddjjddjsjdjdjsjdjsjsjsnsndnjzxjxjdjjddjdjdndnnddn</div>
    </div>
    -->
    
  </section>
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <div id="p" style="padding: 10px;"></div>
  
  <script>
  async function addDiv() {
  const { value: v } = await Swal.fire({
  title: 'Enter',
  html:
  `<input id="a" type="number" class="swal2-input" placeholder="Amount">` +
  `<input id="d" type="date" class="swal2-input">` +
  `<input id="m" type="text" class="swal2-input" placeholder="Desc">`,
  focusConfirm: false,
  showCancelButton: false,
  showCloseButton:true,
  preConfirm: () => {
  const a = document.getElementById('a').value;
  const d = document.getElementById('d').value;
  const m = document.getElementById('m').value;
  if (!a || !d || !m) {
  Swal.showValidationMessage('All required');
  return false;
  }
  return { a, d, m };
  }
  });
  
  if (!v) return;
  
  const e = document.createElement('div');
  e.innerHTML = `
  <div class="box">
  <div class="row"><span class="inso"> ${v.a}</span><span> ${v.d}</span> <span class="teic"> <i class="bi bi-trash" onclick="rdiv(this)"> </i> <i class="bi bi-pencil"> </i></span></div>
  <div class="txt"> ${v.m}  </div>
  </div>
  `;
  
  document.getElementById('transSe').prepend(e);
  
  sumSo();
  addDB();
  }
  
  
  
  
  function getData() {
  const b = document.querySelectorAll('.box');
  const d = [];
  b.forEach(x => {
  const s = x.querySelectorAll('.row span');
  const t = x.querySelector('.txt')?.textContent.trim() || '';
  if (s.length >= 2) {
  d.push({ a: s[0].textContent.trim(), b: s[1].textContent.trim(), t });
  }
  });
  return d;
  }
  
  function makeData(d) {
  d.forEach(x => {
  const b = document.createElement('div');
  b.className = 'box';
  
  const r = document.createElement('div');
  r.className = 'row';
  
  const s1 = document.createElement('span');
  s1.textContent = x.a;
  s1.className="inso";
  
  const s2 = document.createElement('span');
  s2.textContent = x.b;
  
  const sm= document.createElement('span');
  sm.className="teic";
  const s3 = document.createElement('i');
  s3.className="bi bi-trash";
  s3.onclick= function (){
  rdiv(this);
  };
  
  const s4 = document.createElement('i');
  s4.className="bi bi-pencil";
  
  r.appendChild(s1);
  r.appendChild(s2);
  sm.appendChild(s3);
  sm.appendChild(s4);
 r.appendChild(sm);
  
  const t = document.createElement('div');
  t.className = 'txt';
  t.textContent = x.t;
  
  b.appendChild(r);
  b.appendChild(t);
  
  document.getElementById('transSe').prepend(b);
 
  });
  sumSo();
  getXbig(data => { 
  let cfg= JSON.parse(JSON.stringify(data)); 
  document.getElementById('incva').innerText= cfg["inc"];
  
  });
  }
  

  
 
  
  function addDB(){
  let dada= getData();
  
  const r = indexedDB.open("black");
  r.onsuccess = e => {
  const d = e.target.result;
  const t = d.transaction(["sst"], 'readwrite');
  const o = t.objectStore("sst");
  o.put(dada, "blackroadbuff");
  };
  
  }
  
  function readDB() {
  const r = indexedDB.open("black")
  r.onsuccess = e => {
  const d = e.target.result
  const t = d.transaction(["sst"], "readonly")
  const o = t.objectStore("sst").get("blackroadbuff")
  o.onsuccess = () => makeData(o.result)
  }
  }
  
  readDB();
  function sumSo() {
  let s = 0;
  document.querySelectorAll('.inso').forEach(e => {
  let n = parseFloat(e.textContent);
  if (!isNaN(n)) s += n;
  });
   
  document.getElementById("allbal").innerText=s;
  addToXbig({ buff:s });
  }
  
  
  
  
  function rdiv(e) {
  var box = e.closest('.box');
  box.remove();
  
  sumSo();
  addDB();
  }
  
 
  function sxbig() {
  let xbig = { buff: 0, inc: 0, sav: 0, oth: 0 };
  let r = indexedDB.open("black");
  
  r.onupgradeneeded = e => {
  let db = e.target.result;
  if (!db.objectStoreNames.contains("sst")) {
  db.createObjectStore("sst");
  }
  };
  
  r.onsuccess = e => {
  let db = e.target.result;
  if (!db.objectStoreNames.contains("sst")) return;
  
  let tx = db.transaction("sst", "readwrite");
  let store = tx.objectStore("sst");
  
  let getReq = store.get("xbig");
  
  getReq.onsuccess = () => {
  if (getReq.result === undefined) {
  store.put(xbig, "xbig");
  }
  };
  };
  }
  
  
  sxbig();
  
  function getXbig(callback) {
  let r = indexedDB.open("black");
  
  r.onsuccess = e => {
  let db = e.target.result;
  if (!db.objectStoreNames.contains("sst")) return;
  
  let tx = db.transaction("sst", "readonly");
  let store = tx.objectStore("sst");
  
  let g = store.get("xbig");
  g.onsuccess = () => {
  callback(g.result);
  };
  };
  }
  
    // getXbig(data => { alert("xbig value: " + JSON.stringify(data)); });
  
  function addToXbig(add) {
  let r = indexedDB.open("black");
  
  r.onsuccess = e => {
  let db = e.target.result;
  if (!db.objectStoreNames.contains("sst")) return;
  
  let tx = db.transaction("sst", "readwrite");
  let store = tx.objectStore("sst");
  
  let g = store.get("xbig");
  
  g.onsuccess = () => {
  let data = g.result || { buff: 0, inc: 0, sav: 0, oth: 0 };
  
  // Add values
  data.buff = add.buff || 0;
  
  store.put(data, "xbig");
  };
  };
  }
  
 function addX(bu){
  addToXbig({ buff: bu});
  }
  
  
  
  
  </script>
  
  
</body>
</html>